import{j as e,aK as w,i as L,h as R,aL as q,r as b,f as B,C as M,X as f,aM as A,n as P,aN as Q}from"./index-D8RmveFg.js";import{P as H}from"./PageBreadcrumb-Dw5_9Adg.js";import{E as T,D as I,R as p,M as v,u as G,a as _}from"./server.browser-CequAlAg.js";import{b as y,F as K}from"./FormControl-BP6VLzH_.js";import{c as O,a as g,u as V,o as $}from"./index.esm-DbOhfXXi.js";import{g as z}from"./unitService-DP1G9cdD.js";import{F as X,b as U,c as F}from"./Form-BCZM8NW3.js";import{F as S}from"./FormLabel-B53mBRFw.js";import{d as J,u as W,c as Y,a as Z}from"./unitConversionService-BoAk4ZyX.js";import{C as ee,a as ne}from"./Card-C3khdGa0.js";import"./ElementChildren-DUlSq7n6.js";const se=({unitConversions:i=[],onEditUnitConversion:a,onDeleteUnitConversion:o})=>{T.use(I);const c=[{title:"Unidad comercial",data:"comercial_unit"},{title:"Unidad de medida base",data:"base_unit"},{title:"Factor de conversión",data:"conversion_factor"},{title:"Fecha de registro",data:"created_at"},{title:"Acciones",data:null,orderable:!1,render:()=>`
        <div class="d-flex gap-1">
            <button class="btn btn-sm btn-secondary btn-edit">Editar</button>
            <button class="btn btn-sm btn-danger btn-delete">Eliminar</button>
        </div>
        `}],h=i.map(n=>({comercial_unit:n.comercial_unit,base_unit:n.base_unit,conversion_factor:n.conversion_factor,created_at:new Date(n.created_at).toLocaleDateString("es"),id:n.id})),l={responsive:!0,language:{decimal:",",thousands:".",processing:"Procesando...",search:"Buscar:",lengthMenu:"Mostrar _MENU_ registros",info:"Mostrando _START_ a _END_ de _TOTAL_ registros",zeroRecords:"No se encontraron resultados",emptyTable:"No hay datos disponibles en la tabla",paginate:{first:p.renderToStaticMarkup(e.jsx(q,{})),previous:p.renderToStaticMarkup(e.jsx(R,{})),next:p.renderToStaticMarkup(e.jsx(L,{})),last:p.renderToStaticMarkup(e.jsx(w,{}))}},createdRow:(n,s)=>{const t=n.querySelector(".btn-edit"),d=n.querySelector(".btn-delete");t&&t.addEventListener("click",()=>a(s)),d&&d.addEventListener("click",()=>o(s))},initComplete:function(){const n=this.api().table().header();n&&n.classList.add("thead-sm","text-uppercase","fs-xxs")}};return e.jsx(T,{data:h,columns:c,options:l,className:"table table-striped dt-responsive align-middle mb-0"})},te=({open:i,toggle:a,unitConversionData:o,isEditable:c,onSave:h})=>{const[l,n]=b.useState([]),s=O({comercial_unit:g().required("Por favor ingrese el valor de la unidad comercial"),base_unit:g().required("Por favor seleccione la unidad de medida base"),conversion_factor:g().required("Por favor ingrese el valor de factor de conversión")}),{handleSubmit:t,setValue:d,reset:j,register:x,formState:{errors:u}}=V({resolver:$(s)}),C=r=>{h(r)};return b.useEffect(()=>{z().then(r=>n(r))},[]),b.useEffect(()=>{o&&(d("comercial_unit",o.comercial_unit),d("base_unit",o.base_unit),d("conversion_factor",o.conversion_factor))},[o]),b.useEffect(()=>{i||j()},[i]),e.jsx(v,{show:i,onHide:a,centered:!0,children:e.jsxs(X,{onSubmit:t(C),children:[e.jsxs(v.Header,{children:[e.jsxs(v.Title,{children:[c?"Editar":"Crear"," conversión de unidad"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:a})]}),e.jsxs(v.Body,{children:[e.jsxs(B,{children:[e.jsx(M,{md:6,children:e.jsxs(U,{className:"mb-3",children:[e.jsx(S,{children:"Unidad de medida base"}),e.jsxs(F,{...x("base_unit"),isInvalid:!!u.base_unit,children:[e.jsx("option",{value:"",hidden:!0,children:"Seleccionar"}),l.map(r=>e.jsx("option",{value:r.symbol,children:r.symbol},r.id))]}),e.jsx(y,{type:"invalid",children:u.base_unit?.message})]})}),e.jsx(M,{md:6,children:e.jsxs(U,{className:"mb-3",children:[e.jsx(S,{children:"Unidad comercial"}),e.jsxs(F,{...x("comercial_unit"),isInvalid:!!u.comercial_unit,children:[e.jsx("option",{value:"",hidden:!0,children:"Seleccionar"}),l.map(r=>e.jsx("option",{value:r.symbol,children:r.symbol},r.id))]}),e.jsx(y,{type:"invalid",children:u.comercial_unit?.message})]})}),e.jsxs(U,{className:"mb-3",children:[e.jsx(S,{children:"Factor de conversión"}),e.jsx(K,{type:"text",placeholder:"Valor de factor de conversión",...x("conversion_factor"),isInvalid:!!u.conversion_factor}),e.jsx(y,{type:"invalid",children:u.conversion_factor?.message})]})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-3",children:[e.jsx(f,{variant:"light",onClick:a,children:"Cancelar"}),e.jsx(f,{type:"submit",variant:"primary",children:"Guardar"})]})]})]})})},ae=({open:i,toggle:a,onConfirm:o,unitConversionName:c})=>e.jsxs(v,{show:i,onHide:a,centered:!0,children:[e.jsxs(v.Header,{children:[e.jsx(v.Title,{children:"Eliminar conversión de unidad"}),e.jsx("button",{type:"button",className:"btn-close",onClick:a})]}),e.jsxs(v.Body,{children:[e.jsxs("p",{children:["¿Estás seguro que deseas eliminar la conversión"," ",e.jsx("strong",{children:c}),"?"]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-3",children:[e.jsx(f,{variant:"light",onClick:a,children:"Cancelar"}),e.jsx(f,{variant:"danger",onClick:()=>{o(),a()},children:"Eliminar"})]})]})]}),re=()=>{const i=A(),{data:a=[],isLoading:o}=G({queryKey:["unitConversions"],queryFn:Z,staleTime:300*1e3}),c=_({mutationFn:Y,onSuccess:n=>{i.setQueryData(["unitConversions"],(s=[])=>[...s,n.unit_conversion])}}),h=_({mutationFn:({id:n,data:s})=>W(n,s),onSuccess:n=>{i.setQueryData(["unitConversions"],(s=[])=>s.map(t=>t.id===n.unit_conversion.id?n.unit_conversion:t))}}),l=_({mutationFn:J,onSuccess:(n,s)=>{i.setQueryData(["unitConversions"],(t=[])=>t.filter(d=>d.id!==s))}});return{unitConversions:a,loading:o,addUnitConversion:n=>c.mutateAsync(n),editUnitConversion:(n,s)=>h.mutateAsync({id:n,data:s}),removeUnitConversion:n=>l.mutateAsync(n)}},fe=()=>{const{unitConversions:i,loading:a,addUnitConversion:o,editUnitConversion:c,removeUnitConversion:h}=re(),[l,n]=b.useState(!1),[s,t]=b.useState(null),[d,j]=b.useState(!1),x=()=>{t(null),n(!0)},u=m=>{t(m),n(!0)},C=m=>{t(m),j(!0)},r=()=>{n(!1),t(null)},E=()=>{j(!1),t(null)},N=async m=>{try{s?await c(s.id,m):await o(m),r()}catch(D){console.error("Error al guardar unidad de medida:",D)}},k=async()=>{if(s)try{await h(s.id),E()}catch(m){console.error("Error al eliminar unidad de medida:",m)}};return a?e.jsx("p",{children:"Cargando unidades de medida..."}):e.jsxs(P,{fluid:!0,children:[e.jsx(H,{title:"Conversión de unidades",subtitle:"Gestionar"}),e.jsx(ee,{className:"mb-3",children:e.jsxs(ne,{children:[e.jsxs(f,{variant:"primary",className:"mb-3",onClick:x,children:[e.jsx(Q,{className:"me-2"}),"Registrar conversión de unidad"]}),e.jsx(se,{unitConversions:i,onEditUnitConversion:u,onDeleteUnitConversion:C})]})}),e.jsx(te,{open:l,toggle:r,unitConversionData:s,isEditable:!!s,onSave:N}),e.jsx(ae,{open:d,toggle:E,onConfirm:k,unitConversionName:s?.name})]})};export{fe as default};
