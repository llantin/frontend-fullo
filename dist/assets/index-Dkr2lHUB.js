import{j as e,aK as k,i as M,h as T,aL as S,r as b,f as E,C as g,X as f,a as v,aM as L,n as N,bv as R}from"./index-D8RmveFg.js";import{P as K}from"./PageBreadcrumb-Dw5_9Adg.js";import{E as j,D as U,R as x,M as h,u as F,a as _}from"./server.browser-CequAlAg.js";import{b as w}from"./FormControl-BP6VLzH_.js";import{c as $,a as C,u as B,o as A}from"./index.esm-DbOhfXXi.js";import{F as c}from"./Form-BCZM8NW3.js";import{C as O,a as q}from"./Card-C3khdGa0.js";import"./ElementChildren-DUlSq7n6.js";import"./FormLabel-B53mBRFw.js";const P=({inventory:a=[],onExportKardexItem:s})=>{j.use(U);const o=[{title:"Imagen",data:null,orderable:!1,render:t=>`<img src="${t.image?`http://172.16.16.50:8000/storage/${t.image}`:"/placeholder-image.png"}" alt="${t.name}" class="img-thumbnail" style="width: 60px; height: 60px; object-fit: cover;">`},{title:"Nombre",data:"name"},{title:"Descripción",data:"description"},{title:"Stock actual",data:"stock"},{title:"Unidad de medida",data:"unit_measurement"},{title:"Marca",data:"brand"},{title:"Modelo",data:"model"},{title:"Categoria",data:"category"},{title:"Acciones",data:null,orderable:!1,render:()=>`
        <div class="d-flex gap-1">
            <button class="btn btn-sm btn-secondary btn-edit">Kardex</button>
        </div>
        `}],n=a.map(t=>({image:t.image,name:t.name,description:t.description,stock:t.movements[0]?.stock||'<span class="text-muted">No definido</span>',brand:t.brand,model:t.model,category_id:t.category_id,category:t.category.name,unit_measurement:t.unit_measurement,presentation:t.presentation,id:t.id})),r={responsive:!0,language:{decimal:",",thousands:".",processing:"Procesando...",search:"Buscar:",lengthMenu:"Mostrar _MENU_ registros",info:"Mostrando _START_ a _END_ de _TOTAL_ registros",zeroRecords:"No se encontraron resultados",emptyTable:"No hay datos disponibles en la tabla",paginate:{first:x.renderToStaticMarkup(e.jsx(S,{})),previous:x.renderToStaticMarkup(e.jsx(T,{})),next:x.renderToStaticMarkup(e.jsx(M,{})),last:x.renderToStaticMarkup(e.jsx(k,{}))}},createdRow:(t,d)=>{const i=t.querySelector(".btn-edit");i&&i.addEventListener("click",()=>s(d))},initComplete:function(){const t=this.api().table().header();t&&t.classList.add("thead-sm","text-uppercase","fs-xxs")}};return e.jsx(j,{data:n,columns:o,options:r,className:"table table-striped dt-responsive align-middle mb-0"})},D=({open:a,toggle:s,itemData:o,onSave:n})=>{const r=$({init_date:C().required("Por favor ingrese la fecha de inicio"),end_date:C().required("Por favor ingrese la fecha de fin")}),{handleSubmit:t,setValue:d,reset:i,register:m,formState:{errors:l}}=B({resolver:A(r)}),p=y=>{n(y)};return b.useEffect(()=>{o&&(d("item_id",o.id),d("item_name",o.name))},[o]),b.useEffect(()=>{a||i()},[a]),e.jsx(h,{show:a,onHide:s,centered:!0,children:e.jsxs(c,{onSubmit:t(p),children:[e.jsxs(h.Header,{children:[e.jsx(h.Title,{children:"Kardex de articulo"}),e.jsx("button",{type:"button",className:"btn-close",onClick:s})]}),e.jsxs(h.Body,{children:[e.jsxs(E,{className:"mb-3",children:[e.jsx(g,{md:6,className:"mb-3",children:e.jsxs(c.Group,{children:[e.jsx(c.Label,{children:"Fecha de inicio"}),e.jsx(c.Control,{type:"date",...m("init_date"),isInvalid:!!l.init_date}),e.jsx(w,{type:"invalid",children:l.init_date?.message})]})}),e.jsx(g,{md:6,className:"mb-3",children:e.jsxs(c.Group,{children:[e.jsx(c.Label,{children:"Fecha de fin"}),e.jsx(c.Control,{type:"date",...m("end_date"),isInvalid:!!l.end_date}),e.jsx(w,{type:"invalid",children:l.end_date?.message})]})}),e.jsx(c.Control,{type:"text",...m("item_id"),isInvalid:!!l.item_id,hidden:!0}),e.jsx(c.Control,{type:"text",...m("item_name"),isInvalid:!!l.item_name,hidden:!0})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-3",children:[e.jsx(f,{variant:"light",onClick:s,children:"Cancelar"}),e.jsx(f,{type:"submit",variant:"primary",children:"Exportar"})]})]})]})})},H=async()=>{const{data:a}=await v.get("/inventory");return a.inventory},G=async()=>{const a=await v.get("/export-inventory",{responseType:"blob"}),s=new Blob([a.data],{type:a.headers["content-type"]}),o=window.URL.createObjectURL(s),n=document.createElement("a");n.href=o;const r=a.headers["content-disposition"];let d=`Inventario Fullo ${new Date().toISOString().split("T")[0]}.xlsx`;if(r){const i=r.match(/filename="?(.+)"?/);i&&i[1]&&(d=i[1])}n.setAttribute("download",d),document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(o)},Q=async a=>{const s=await v.get(`/export-kardex/${a.item_id}/${a.init_date}/${a.end_date}`,{responseType:"blob"}),o=new Blob([s.data],{type:s.headers["content-type"]}),n=window.URL.createObjectURL(o),r=document.createElement("a");r.href=n;const t=s.headers["content-disposition"];let d=`Kardex - ${a.item_name}.xlsx`;if(t){const i=t.match(/filename="?(.+)"?/);i&&i[1]&&(d=i[1])}r.setAttribute("download",d),document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(n)},z=()=>{L();const{data:a=[],isLoading:s}=F({queryKey:["inventory"],queryFn:H,staleTime:300*1e3}),o=_({mutationFn:G}),n=_({mutationFn:Q});return{inventory:a,loading:s,exportInventory:()=>o.mutateAsync(),exportKardexItem:r=>n.mutateAsync(r)}},ne=()=>{const{inventory:a,loading:s,exportInventory:o,exportKardexItem:n}=z(),[r,t]=b.useState(!1),[d,i]=b.useState(null),m=async()=>{try{await o()}catch(u){console.error("Error al exportar inventario:",u)}},l=u=>{i(u),t(!0)},p=()=>{t(!1),i(null)},y=async u=>{try{await n(u),p()}catch(I){console.error("Error al exportar kardex de artículo:",I)}};return s?e.jsx("p",{children:"Cargando inventario..."}):e.jsxs(N,{fluid:!0,children:[e.jsx(K,{title:"Inventario",subtitle:"Gestionar"}),e.jsx(O,{className:"mb-3",children:e.jsxs(q,{children:[e.jsxs(f,{variant:"secondary",className:"mb-3",onClick:m,children:[e.jsx(R,{className:"me-2"}),"Exportar inventario"]}),e.jsx(P,{inventory:a,onExportKardexItem:l})]})}),e.jsx(D,{open:r,itemData:d,toggle:p,onSave:y})]})};export{ne as default};
