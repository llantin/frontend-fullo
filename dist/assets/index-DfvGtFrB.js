import{j as e,aK as w,i as D,h as L,aL as A,r as v,f as _,C as h,X as g,aM as B,n as $,aN as Q}from"./index-D8RmveFg.js";import{P as U}from"./PageBreadcrumb-Dw5_9Adg.js";import{E as M,D as H,R as P,M as m,u as G,a as N}from"./server.browser-CequAlAg.js";import{F as y,b as x}from"./FormControl-BP6VLzH_.js";import{c as K,a as j,u as O,o as z}from"./index.esm-DbOhfXXi.js";import{F as V,b as f,c as F}from"./Form-BCZM8NW3.js";import{F as b}from"./FormLabel-B53mBRFw.js";import{d as X,u as J,c as W,g as Y}from"./personService-I6xLoZZw.js";import{C as Z,a as ee}from"./Card-C3khdGa0.js";import"./ElementChildren-DUlSq7n6.js";const ne=({people:l=[],onEditPerson:r,onDeletePerson:t})=>{M.use(H);const d=[{title:"Nombres completos",data:"fullname"},{title:"Correo",data:"email"},{title:"Telefono",data:"phone"},{title:"Tipo de persona",data:"type"},{title:"Tipo y número de identificación",data:"type_number"},{title:"Fecha de registro",data:"created_at"},{title:"Acciones",data:null,orderable:!1,render:()=>`
        <div class="d-flex gap-1">
            <button class="btn btn-sm btn-secondary btn-edit">Editar</button>
            <button class="btn btn-sm btn-danger btn-delete">Eliminar</button>
        </div>
        `}],u=l.map(n=>({fullname:`${n.name||""} ${n.last_name||""}`,name:n.name,last_name:n.name,email:n.email,phone:n.phone,type:n.type,identification_type:n.identification_type,identification_number:n.identification_number,type_number:`${n.identification_type||""} - ${n.identification_number||""}`,created_at:new Date(n.created_at).toLocaleDateString("es"),id:n.id})),p={responsive:!0,language:{decimal:",",thousands:".",processing:"Procesando...",search:"Buscar:",lengthMenu:"Mostrar _MENU_ registros",info:"Mostrando _START_ a _END_ de _TOTAL_ registros",zeroRecords:"No se encontraron resultados",emptyTable:"No hay datos disponibles en la tabla",paginate:{first:P.renderToStaticMarkup(e.jsx(A,{})),previous:P.renderToStaticMarkup(e.jsx(L,{})),next:P.renderToStaticMarkup(e.jsx(D,{})),last:P.renderToStaticMarkup(e.jsx(w,{}))}},createdRow:(n,s)=>{const i=n.querySelector(".btn-edit"),o=n.querySelector(".btn-delete");i&&i.addEventListener("click",()=>r(s)),o&&o.addEventListener("click",()=>t(s))},initComplete:function(){const n=this.api().table().header();n&&n.classList.add("thead-sm","text-uppercase","fs-xxs")}};return e.jsx(M,{data:u,columns:d,options:p,className:"table table-striped dt-responsive align-middle mb-0"})},se=({open:l,toggle:r,personData:t,isEditable:d,onSave:u})=>{const p=K({name:j().required("Por favor ingrese el nombre de la persona"),last_name:j().required("Por favor ingrese el apellido de la persona"),email:j().required("Por favor ingrese el correo de la persona"),phone:j().required("Por favor ingrese el telefono de la persona"),identification_type:j().required("Por favor seleccione el tipo de identificacion de la persona"),identification_number:j().required("Por favor ingrese el numero de identificacion de la persona"),type:j().required("Por favor seleccione el tipo de persona")}),{handleSubmit:n,setValue:s,reset:i,register:o,formState:{errors:a}}=O({resolver:z(p)}),C=S=>{u(S)};return v.useEffect(()=>{t&&(s("name",t.name),s("last_name",t.last_name),s("email",t.email),s("phone",t.phone),s("identification_type",t.identification_type),s("identification_number",t.identification_number),s("type",t.type))},[t]),v.useEffect(()=>{l||i()},[l]),e.jsx(m,{show:l,onHide:r,centered:!0,children:e.jsxs(V,{onSubmit:n(C),children:[e.jsxs(m.Header,{children:[e.jsxs(m.Title,{children:[d?"Editar":"Crear"," persona"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:r})]}),e.jsxs(m.Body,{children:[e.jsxs(_,{children:[e.jsx(h,{md:6,className:"mb-3",children:e.jsxs(f,{children:[e.jsx(b,{children:"Nombres"}),e.jsx(y,{type:"text",placeholder:"Ingrese nombres",...o("name"),isInvalid:!!a.name}),e.jsx(x,{type:"invalid",children:a.name?.message})]})}),e.jsx(h,{md:6,className:"mb-3",children:e.jsxs(f,{children:[e.jsx(b,{children:"Apellidos"}),e.jsx(y,{type:"text",placeholder:"Ingrese apellidos",...o("last_name"),isInvalid:!!a.last_name}),e.jsx(x,{type:"invalid",children:a.last_name?.message})]})})]}),e.jsxs(_,{children:[e.jsx(h,{md:6,className:"mb-3",children:e.jsxs(f,{children:[e.jsx(b,{children:"Correo electrónico"}),e.jsx(y,{type:"text",placeholder:"Ingrese correo",...o("email"),isInvalid:!!a.email}),e.jsx(x,{type:"invalid",children:a.email?.message})]})}),e.jsx(h,{md:6,className:"mb-3",children:e.jsxs(f,{children:[e.jsx(b,{children:"Teléfono"}),e.jsx(y,{type:"text",placeholder:"Ingrese teléfono",...o("phone"),isInvalid:!!a.phone}),e.jsx(x,{type:"invalid",children:a.phone?.message})]})})]}),e.jsxs(_,{children:[e.jsx(h,{md:6,className:"mb-3",children:e.jsxs(f,{children:[e.jsx(b,{children:"Tipo de identificación"}),e.jsxs(F,{...o("identification_type"),isInvalid:!!a.identification_type,children:[e.jsx("option",{value:"",hidden:!0,children:"Seleccionar"}),e.jsx("option",{value:"DNI",children:"DNI"}),e.jsx("option",{value:"RUC",children:"RUC"})]}),e.jsx(x,{type:"invalid",children:a.identification_type?.message})]})}),e.jsx(h,{md:6,className:"mb-3",children:e.jsxs(f,{children:[e.jsx(b,{children:"Numero de identificación"}),e.jsx(y,{type:"text",placeholder:"Ingrese el número de ident.",...o("identification_number"),isInvalid:!!a.identification_number}),e.jsx(x,{type:"invalid",children:a.identification_number?.message})]})})]}),e.jsx(_,{children:e.jsx(h,{md:12,className:"mb-3",children:e.jsxs(f,{children:[e.jsx(b,{children:"Tipo de persona"}),e.jsxs(F,{...o("type"),isInvalid:!!a.type,children:[e.jsx("option",{value:"",hidden:!0,children:"Seleccionar"}),e.jsx("option",{value:"Cliente",children:"Cliente"}),e.jsx("option",{value:"Proveedor",children:"Proveedor"}),e.jsx("option",{value:"Usuario",children:"Usuario"})]}),e.jsx(x,{type:"invalid",children:a.type?.message})]})})}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-3",children:[e.jsx(g,{variant:"light",onClick:r,children:"Cancelar"}),e.jsx(g,{type:"submit",variant:"primary",children:"Guardar"})]})]})]})})},te=({open:l,toggle:r,onConfirm:t,personName:d})=>e.jsxs(m,{show:l,onHide:r,centered:!0,children:[e.jsxs(m.Header,{children:[e.jsx(m.Title,{children:"Eliminar persona"}),e.jsx("button",{type:"button",className:"btn-close",onClick:r})]}),e.jsxs(m.Body,{children:[e.jsxs("p",{children:["¿Estás seguro que deseas eliminar a ",e.jsx("strong",{children:d}),"?"]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-3",children:[e.jsx(g,{variant:"light",onClick:r,children:"Cancelar"}),e.jsx(g,{variant:"danger",onClick:()=>{t(),r()},children:"Eliminar"})]})]})]}),ae=()=>{const l=B(),{data:r=[],isLoading:t}=G({queryKey:["people"],queryFn:Y,staleTime:300*1e3}),d=N({mutationFn:W,onSuccess:n=>{l.setQueryData(["people"],(s=[])=>[...s,n.person])}}),u=N({mutationFn:({id:n,data:s})=>J(n,s),onSuccess:n=>{l.setQueryData(["people"],(s=[])=>s.map(i=>i.id===n.person.id?n.person:i))}}),p=N({mutationFn:X,onSuccess:(n,s)=>{l.setQueryData(["people"],(i=[])=>i.filter(o=>o.id!==s))}});return{people:r,loading:t,addPerson:n=>d.mutateAsync(n),editPerson:(n,s)=>u.mutateAsync({id:n,data:s}),removePerson:n=>p.mutateAsync(n)}},xe=()=>{const{people:l,loading:r,addPerson:t,editPerson:d,removePerson:u}=ae(),[p,n]=v.useState(!1),[s,i]=v.useState(null),[o,a]=v.useState(!1),C=()=>{i(null),n(!0)},S=c=>{i(c),n(!0)},I=c=>{i(c),a(!0)},T=()=>{n(!1),i(null)},E=()=>{a(!1),i(null)},k=async c=>{try{s?await d(s.id,c):await t(c),T()}catch(R){console.error("Error al guardar persona:",R)}},q=async()=>{if(s)try{await u(s.id),E()}catch(c){console.error("Error al eliminar persona:",c)}};return r?e.jsx("p",{children:"Cargando personas..."}):e.jsxs($,{fluid:!0,children:[e.jsx(U,{title:"Personas",subtitle:"Gestionar"}),e.jsx(Z,{className:"mb-3",children:e.jsxs(ee,{children:[e.jsxs(g,{variant:"primary",className:"mb-3",onClick:C,children:[e.jsx(Q,{className:"me-2"}),"Registrar persona"]}),e.jsx(ne,{people:l,onEditPerson:S,onDeletePerson:I})]})}),e.jsx(se,{open:p,toggle:T,personData:s,isEditable:!!s,onSave:k}),e.jsx(te,{open:o,toggle:E,onConfirm:q,personName:s?.fullname})]})};export{xe as default};
