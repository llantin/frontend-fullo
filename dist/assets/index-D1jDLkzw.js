import{j as e,aK as _,i as w,h as L,aL as R,r as b,f as q,X as p,aM as B,n as A,aN as P}from"./index-D8RmveFg.js";import{P as Q}from"./PageBreadcrumb-Dw5_9Adg.js";import{E as M,D as H,R as x,M as m,u as I,a as f}from"./server.browser-CequAlAg.js";import{F as v,b as g}from"./FormControl-BP6VLzH_.js";import{c as G,a as C,u as K,o as O}from"./index.esm-DbOhfXXi.js";import{F as $,b as S}from"./Form-BCZM8NW3.js";import{F as U}from"./FormLabel-B53mBRFw.js";import{d as z,u as V,c as X,g as J}from"./unitService-DP1G9cdD.js";import{C as W,a as Y}from"./Card-C3khdGa0.js";import"./ElementChildren-DUlSq7n6.js";const Z=({units:i=[],onEditUnit:n,onDeleteUnit:r})=>{M.use(H);const o=[{title:"Nombre",data:"name"},{title:"Simbolo",data:"symbol"},{title:"Tipo de unidad",data:"type"},{title:"Fecha de registro",data:"created_at"},{title:"Acciones",data:null,orderable:!1,render:()=>`
        <div class="d-flex gap-1">
            <button class="btn btn-sm btn-secondary btn-edit">Editar</button>
            <button class="btn btn-sm btn-danger btn-delete">Eliminar</button>
        </div>
        `}],u=i.map(t=>({name:t.name,symbol:t.symbol,type:t.type,created_at:new Date(t.created_at).toLocaleDateString("es"),id:t.id})),h={responsive:!0,language:{decimal:",",thousands:".",processing:"Procesando...",search:"Buscar:",lengthMenu:"Mostrar _MENU_ registros",info:"Mostrando _START_ a _END_ de _TOTAL_ registros",zeroRecords:"No se encontraron resultados",emptyTable:"No hay datos disponibles en la tabla",paginate:{first:x.renderToStaticMarkup(e.jsx(R,{})),previous:x.renderToStaticMarkup(e.jsx(L,{})),next:x.renderToStaticMarkup(e.jsx(w,{})),last:x.renderToStaticMarkup(e.jsx(_,{}))}},createdRow:(t,a)=>{const s=t.querySelector(".btn-edit"),d=t.querySelector(".btn-delete");s&&s.addEventListener("click",()=>n(a)),d&&d.addEventListener("click",()=>r(a))},initComplete:function(){const t=this.api().table().header();t&&t.classList.add("thead-sm","text-uppercase","fs-xxs")}};return e.jsx(M,{data:u,columns:o,options:h,className:"table table-striped dt-responsive align-middle mb-0"})},ee=({open:i,toggle:n,unitData:r,isEditable:o,onSave:u})=>{const h=G({name:C().required("Por favor ingrese el nombre de la unidad de medida"),symbol:C().required("Por favor ingrese el simbolo de la unidad de medida"),type:C().required("Por favor ingrese el tipo de unidad de medida")}),{handleSubmit:t,setValue:a,reset:s,register:d,formState:{errors:l}}=K({resolver:O(h)}),y=j=>{u(j)};return b.useEffect(()=>{r&&(a("name",r.name),a("symbol",r.symbol),a("type",r.type))},[r]),b.useEffect(()=>{i||s()},[i]),e.jsx(m,{show:i,onHide:n,centered:!0,children:e.jsxs($,{onSubmit:t(y),children:[e.jsxs(m.Header,{children:[e.jsxs(m.Title,{children:[o?"Editar":"Crear"," unidad de medida"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:n})]}),e.jsxs(m.Body,{children:[e.jsxs(q,{children:[e.jsxs(S,{className:"mb-3",children:[e.jsx(U,{children:"Nombre"}),e.jsx(v,{type:"text",placeholder:"Nombre de la unidad de medida",...d("name"),isInvalid:!!l.name}),e.jsx(g,{type:"invalid",children:l.name?.message})]}),e.jsxs(S,{className:"mb-3",children:[e.jsx(U,{children:"Simbolo"}),e.jsx(v,{type:"text",placeholder:"Simbolo de la unidad de medida",...d("symbol"),isInvalid:!!l.symbol}),e.jsx(g,{type:"invalid",children:l.symbol?.message})]}),e.jsxs(S,{className:"mb-3",children:[e.jsx(U,{children:"Tipo"}),e.jsx(v,{type:"text",placeholder:"Tipo de la unidad de medida",...d("type"),isInvalid:!!l.type}),e.jsx(g,{type:"invalid",children:l.type?.message})]})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-3",children:[e.jsx(p,{variant:"light",onClick:n,children:"Cancelar"}),e.jsx(p,{type:"submit",variant:"primary",children:"Guardar"})]})]})]})})},te=({open:i,toggle:n,onConfirm:r,unitName:o})=>e.jsxs(m,{show:i,onHide:n,centered:!0,children:[e.jsxs(m.Header,{children:[e.jsx(m.Title,{children:"Eliminar unidad de medida"}),e.jsx("button",{type:"button",className:"btn-close",onClick:n})]}),e.jsxs(m.Body,{children:[e.jsxs("p",{children:["¿Estás seguro que deseas eliminar la unidad de medida"," ",e.jsx("strong",{children:o}),"?"]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-3",children:[e.jsx(p,{variant:"light",onClick:n,children:"Cancelar"}),e.jsx(p,{variant:"danger",onClick:()=>{r(),n()},children:"Eliminar"})]})]})]}),ae=()=>{const i=B(),{data:n=[],isLoading:r}=I({queryKey:["units"],queryFn:J,staleTime:300*1e3}),o=f({mutationFn:X,onSuccess:t=>{i.setQueryData(["units"],(a=[])=>[...a,t.unit])}}),u=f({mutationFn:({id:t,data:a})=>V(t,a),onSuccess:t=>{i.setQueryData(["units"],(a=[])=>a.map(s=>s.id===t.unit.id?t.unit:s))}}),h=f({mutationFn:z,onSuccess:(t,a)=>{i.setQueryData(["units"],(s=[])=>s.filter(d=>d.id!==a))}});return{units:n,loading:r,addUnit:t=>o.mutateAsync(t),editUnit:(t,a)=>u.mutateAsync({id:t,data:a}),removeUnit:t=>h.mutateAsync(t)}},he=()=>{const{units:i,loading:n,addUnit:r,editUnit:o,removeUnit:u}=ae(),[h,t]=b.useState(!1),[a,s]=b.useState(null),[d,l]=b.useState(!1),y=()=>{s(null),t(!0)},j=c=>{s(c),t(!0)},N=c=>{s(c),l(!0)},E=()=>{t(!1),s(null)},T=()=>{l(!1),s(null)},F=async c=>{try{a?await o(a.id,c):await r(c),E()}catch(D){console.error("Error al guardar unidad de medida:",D)}},k=async()=>{if(a)try{await u(a.id),T()}catch(c){console.error("Error al eliminar unidad de medida:",c)}};return n?e.jsx("p",{children:"Cargando unidades de medida..."}):e.jsxs(A,{fluid:!0,children:[e.jsx(Q,{title:"Unidades de medida",subtitle:"Gestionar"}),e.jsx(W,{className:"mb-3",children:e.jsxs(Y,{children:[e.jsxs(p,{variant:"primary",className:"mb-3",onClick:y,children:[e.jsx(P,{className:"me-2"}),"Registrar unidad de medida"]}),e.jsx(Z,{units:i,onEditUnit:j,onDeleteUnit:N})]})}),e.jsx(ee,{open:h,toggle:E,unitData:a,isEditable:!!a,onSave:F}),e.jsx(te,{open:d,toggle:T,onConfirm:k,unitName:a?.name})]})};export{he as default};
