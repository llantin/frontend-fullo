import{j as e,aK as L,i as R,h as D,aL as A,r as v,C as u,f as S,X as k,aM as B,n as $,aN as U}from"./index-D8RmveFg.js";import{P as Q}from"./PageBreadcrumb-Dw5_9Adg.js";import{E as q,D as H,R as E,M as y,u as G,a as T}from"./server.browser-CequAlAg.js";import{F as g,b as h}from"./FormControl-BP6VLzH_.js";import{c as O,a as b,b as K,d as z,u as V,o as X}from"./index.esm-DbOhfXXi.js";import{g as J}from"./categoryService-Bkz0X63C.js";import{g as W}from"./unitService-DP1G9cdD.js";import{F as Y,b as x,c as F}from"./Form-BCZM8NW3.js";import{F as p}from"./FormLabel-B53mBRFw.js";import{d as Z,u as ee,c as se,g as re}from"./itemService-hMfL8RRy.js";import{C as te,a as ae}from"./Card-C3khdGa0.js";import"./ElementChildren-DUlSq7n6.js";const ie=({items:c=[],onEditItem:l,onDeleteItem:a})=>{q.use(H);const j=[{title:"Imagen",data:null,orderable:!1,render:s=>`<img src="${s.image?`http://172.16.16.50:8000/storage/${s.image}`:"/placeholder-image.png"}" alt="${s.name}" class="img-thumbnail" style="width: 60px; height: 60px; object-fit: cover;">`},{title:"Nombre",data:"name"},{title:"Descripción",data:"description"},{title:"Precio estimado",data:"price"},{title:"Marca",data:"brand"},{title:"Modelo",data:"model"},{title:"Categoria",data:"category"},{title:"Fecha de registro",data:"created_at"},{title:"Acciones",data:null,orderable:!1,render:()=>`
        <div class="d-flex gap-1">
            <button class="btn btn-sm btn-secondary btn-edit">Editar</button>
            <button class="btn btn-sm btn-danger btn-delete">Eliminar</button>
        </div>
        `}],I=c.map(s=>({image:s.image,name:s.name,description:s.description,price:s.price,brand:s.brand,model:s.model,category_id:s.category_id,category:s.category.name,unit_measurement:s.unit_measurement,presentation:s.presentation,minimum_stock:s.minimum_stock,maximum_stock:s.maximum_stock,created_at:new Date(s.created_at).toLocaleDateString("es"),id:s.id})),_={responsive:!0,language:{decimal:",",thousands:".",processing:"Procesando...",search:"Buscar:",lengthMenu:"Mostrar _MENU_ registros",info:"Mostrando _START_ a _END_ de _TOTAL_ registros",zeroRecords:"No se encontraron resultados",emptyTable:"No hay datos disponibles en la tabla",paginate:{first:E.renderToStaticMarkup(e.jsx(A,{})),previous:E.renderToStaticMarkup(e.jsx(D,{})),next:E.renderToStaticMarkup(e.jsx(R,{})),last:E.renderToStaticMarkup(e.jsx(L,{}))}},createdRow:(s,t)=>{const o=s.querySelector(".btn-edit"),f=s.querySelector(".btn-delete");o&&o.addEventListener("click",()=>l(t)),f&&f.addEventListener("click",()=>a(t))},initComplete:function(){const s=this.api().table().header();s&&s.classList.add("thead-sm","text-uppercase","fs-xxs")}};return e.jsx(q,{data:I,columns:j,options:_,className:"table table-striped dt-responsive align-middle mb-0"})},ne=({open:c,toggle:l,itemData:a,isEditable:j,onSave:I})=>{const[_,s]=v.useState([]),[t,o]=v.useState([]),f=O({image:z().required("Por favor selecicone la imagen"),name:b().required("Por favor ingrese el nombre"),description:b().required("Por favor ingrese la descripcion"),price:K().typeError("Por favor ingrese un precio válido").required("Por favor ingrese el precio"),brand:b().required("Por favor ingrese la marca"),model:b().required("Por favor ingrese el modelo"),unit_measurement:b().required("Por favor ingrese la unidad de medida"),presentation:b().required("Por favor ingrese la presentación"),minimum_stock:b().required("Por favor ingrese el stock minimo"),maximum_stock:b().required("Por favor ingrese el stock maximo"),category_id:b().required("Por favor seleccione una categoría")}),{handleSubmit:N,setValue:m,reset:P,register:d,formState:{errors:r}}=V({resolver:X(f)}),M=i=>{const C=new FormData;Object.keys(i).forEach(n=>{n==="image"&&i[n]&&i[n].length>0?C.append(n,i[n][0]):n!=="image"&&C.append(n,i[n])}),I(C)};return v.useEffect(()=>{J().then(i=>s(i)),W().then(i=>o(i))},[]),v.useEffect(()=>{a&&(m("name",a.name),m("description",a.description),m("price",a.price),m("brand",a.brand),m("model",a.model),m("unit_measurement",a.unit_measurement),m("presentation",a.presentation),m("minimum_stock",a.minimum_stock),m("maximum_stock",a.maximum_stock),m("category_id",a.category_id))},[a]),v.useEffect(()=>{c||P()},[c]),e.jsx(y,{show:c,onHide:l,centered:!0,children:e.jsxs(Y,{onSubmit:N(M),children:[e.jsxs(y.Header,{children:[e.jsxs(y.Title,{children:[j?"Editar":"Crear"," articulo"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:l})]}),e.jsxs(y.Body,{children:[!j&&e.jsx(u,{md:12,className:"mb-3",children:e.jsxs(x,{children:[e.jsx(p,{children:"Imagen de articulo"}),e.jsx(g,{type:"file",...d("image"),isInvalid:!!r.image}),e.jsx(h,{type:"invalid",children:r.image?.message})]})}),e.jsxs(S,{children:[e.jsx(u,{md:12,className:"mb-3",children:e.jsxs(x,{children:[e.jsx(p,{children:"Nombre"}),e.jsx(g,{type:"text",placeholder:"Ingrese nombre del articulo",...d("name"),isInvalid:!!r.name}),e.jsx(h,{type:"invalid",children:r.name?.message})]})}),e.jsx(u,{md:12,className:"mb-3",children:e.jsxs(x,{children:[e.jsx(p,{children:"Descripcion"}),e.jsx(g,{type:"text",placeholder:"Ingrese descripcion del articulo",...d("description"),isInvalid:!!r.description}),e.jsx(h,{type:"invalid",children:r.description?.message})]})})]}),e.jsxs(S,{children:[e.jsx(u,{md:4,className:"mb-3",children:e.jsxs(x,{children:[e.jsx(p,{children:"Precio"}),e.jsx(g,{type:"number",placeholder:"Ingrese precio",...d("price"),isInvalid:!!r.price,step:"0.01"}),e.jsx(h,{type:"invalid",children:r.price?.message})]})}),e.jsx(u,{md:4,className:"mb-3",children:e.jsxs(x,{children:[e.jsx(p,{children:"Marca"}),e.jsx(g,{type:"text",placeholder:"Ingrese marca",...d("brand"),isInvalid:!!r.brand}),e.jsx(h,{type:"invalid",children:r.brand?.message})]})}),e.jsx(u,{md:4,className:"mb-3",children:e.jsxs(x,{children:[e.jsx(p,{children:"Modelo"}),e.jsx(g,{type:"text",placeholder:"Ingrese modelo",...d("model"),isInvalid:!!r.model}),e.jsx(h,{type:"invalid",children:r.model?.message})]})})]}),e.jsxs(S,{children:[e.jsx(u,{md:6,className:"mb-3",children:e.jsxs(x,{children:[e.jsx(p,{children:"Unidad de medida"}),e.jsxs(F,{...d("unit_measurement"),isInvalid:!!r.unit_measurement,children:[e.jsx("option",{value:"",hidden:!0,children:"Seleccionar"}),t.map(i=>e.jsxs("option",{value:i.symbol,children:[i.name," (",i.symbol,")"]},i.id))]}),e.jsx(h,{type:"invalid",children:r.unit_measurement?.message})]})}),e.jsx(u,{md:6,className:"mb-3",children:e.jsxs(x,{children:[e.jsx(p,{children:"Presentación"}),e.jsx(g,{type:"text",placeholder:"Ingrese presentación",...d("presentation"),isInvalid:!!r.presentation}),e.jsx(h,{type:"invalid",children:r.presentation?.message})]})})]}),e.jsxs(S,{children:[e.jsx(u,{md:6,className:"mb-3",children:e.jsxs(x,{children:[e.jsx(p,{children:"Stock minimo"}),e.jsx(g,{type:"number",placeholder:"Ingrese stock minimo",...d("minimum_stock"),isInvalid:!!r.minimum_stock}),e.jsx(h,{type:"invalid",children:r.minimum_stock?.message})]})}),e.jsx(u,{md:6,className:"mb-3",children:e.jsxs(x,{children:[e.jsx(p,{children:"Stock maximo"}),e.jsx(g,{type:"number",placeholder:"Ingrese stock maximo",...d("maximum_stock"),isInvalid:!!r.maximum_stock}),e.jsx(h,{type:"invalid",children:r.maximum_stock?.message})]})})]}),e.jsx(S,{className:"mb-3",children:e.jsx(u,{md:12,children:e.jsxs(x,{children:[e.jsx(p,{children:"Categoría"}),e.jsxs(F,{...d("category_id"),isInvalid:!!r.category_id,children:[e.jsx("option",{value:"",hidden:!0,children:"Seleccionar"}),_.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]}),e.jsx(h,{type:"invalid",children:r.category_id?.message})]})})}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-3",children:[e.jsx(k,{variant:"light",onClick:l,children:"Cancelar"}),e.jsx(k,{type:"submit",variant:"primary",children:"Guardar"})]})]})]})})},oe=({open:c,toggle:l,onConfirm:a,itemName:j})=>e.jsxs(y,{show:c,onHide:l,centered:!0,children:[e.jsxs(y.Header,{children:[e.jsx(y.Title,{children:"Eliminar artículo"}),e.jsx("button",{type:"button",className:"btn-close",onClick:l})]}),e.jsxs(y.Body,{children:[e.jsxs("p",{children:["¿Estás seguro que deseas eliminar el artículo ",e.jsx("strong",{children:j}),"?"]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-3",children:[e.jsx(k,{variant:"light",onClick:l,children:"Cancelar"}),e.jsx(k,{variant:"danger",onClick:()=>{a(),l()},children:"Eliminar"})]})]})]}),le=()=>{const c=B(),{data:l=[],isLoading:a}=G({queryKey:["items"],queryFn:re,staleTime:300*1e3}),j=T({mutationFn:se,onSuccess:s=>{c.setQueryData(["items"],(t=[])=>[...t,s.item])}}),I=T({mutationFn:({id:s,data:t})=>ee(s,t),onSuccess:s=>{c.setQueryData(["items"],(t=[])=>t.map(o=>o.id===s.item.id?s.item:o))}}),_=T({mutationFn:Z,onSuccess:(s,t)=>{c.setQueryData(["items"],(o=[])=>o.filter(f=>f.id!==t))}});return{items:l,loading:a,addItem:s=>j.mutateAsync(s),editItem:(s,t)=>I.mutateAsync({id:s,data:t}),removeItem:s=>_.mutateAsync(s)}},ye=()=>{const{items:c,loading:l,addItem:a,editItem:j,removeItem:I}=le(),[_,s]=v.useState(!1),[t,o]=v.useState(null),[f,N]=v.useState(!1),m=()=>{o(null),s(!0)},P=n=>{o(n),s(!0)},d=n=>{o(n),N(!0)},r=()=>{s(!1),o(null)},M=()=>{N(!1),o(null)},i=async n=>{try{t?await j(t.id,n):await a(n),r()}catch(w){console.error("Error al guardar artículo:",w)}},C=async()=>{if(t)try{await I(t.id),M()}catch(n){console.error("Error al eliminar artículo:",n)}};return l?e.jsx("p",{children:"Cargando artículos..."}):e.jsxs($,{fluid:!0,children:[e.jsx(Q,{title:"Artículos",subtitle:"Gestionar"}),e.jsx(te,{className:"mb-3",children:e.jsxs(ae,{children:[e.jsxs(k,{variant:"primary",className:"mb-3",onClick:m,children:[e.jsx(U,{className:"me-2"}),"Registrar articulo"]}),e.jsx(ie,{items:c,onEditItem:P,onDeleteItem:d})]})}),e.jsx(ne,{open:_,toggle:r,itemData:t,isEditable:!!t,onSave:i}),e.jsx(oe,{open:f,toggle:M,onConfirm:C,itemName:t?.name})]})};export{ye as default};
