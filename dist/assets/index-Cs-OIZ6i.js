import{j as e,aK as M,i as f,h as y,aL as j,X as p,a as v,aM as _,r as h,n as g}from"./index-D8RmveFg.js";import{P as C}from"./PageBreadcrumb-Dw5_9Adg.js";import{E as x,D as T,R as l,M as c,u as S,a as D}from"./server.browser-CequAlAg.js";import{C as E,a as k}from"./Card-C3khdGa0.js";const q=({movements:a=[],onDeleteMovement:s})=>{x.use(T);const n=[{title:"Código de comprobante",data:"receipt_code"},{title:"Artículo",data:"item_name"},{title:"Usuario responsable",data:"user_name"},{title:"Cantidad",data:"quantity"},{title:"Unidad de medida",data:"unit_measurement"},{title:"Precio",data:"price"},{title:"Tipo de movimiento",data:"type"},{title:"Fecha de registro",data:"created_at"},{title:"Acciones",data:null,orderable:!1,render:()=>`
        <div class="d-flex gap-1">
            <button class="btn btn-sm btn-danger btn-delete">Eliminar</button>
        </div>
        `}],o=a.map(t=>({receipt_code:t.receipt.receipt_code,item_name:t.item.name,user_name:`${t.user.person?.name||""} ${t.user.person?.last_name||""}`,quantity:t.quantity,unit_measurement:t.receipt_detail.unit,price:`S/. ${t.price}`,type:t.type,created_at:new Date(t.created_at).toLocaleDateString("es"),id:t.id})),r={responsive:!0,language:{decimal:",",thousands:".",processing:"Procesando...",search:"Buscar:",lengthMenu:"Mostrar _MENU_ registros",info:"Mostrando _START_ a _END_ de _TOTAL_ registros",zeroRecords:"No se encontraron resultados",emptyTable:"No hay datos disponibles en la tabla",paginate:{first:l.renderToStaticMarkup(e.jsx(j,{})),previous:l.renderToStaticMarkup(e.jsx(y,{})),next:l.renderToStaticMarkup(e.jsx(f,{})),last:l.renderToStaticMarkup(e.jsx(M,{}))}},createdRow:(t,i)=>{const d=t.querySelector(".btn-delete");d&&d.addEventListener("click",()=>s(i))},initComplete:function(){const t=this.api().table().header();t&&t.classList.add("thead-sm","text-uppercase","fs-xxs")}};return e.jsx(x,{data:o,columns:n,options:r,className:"table table-striped dt-responsive align-middle mb-0"})},w=({open:a,toggle:s,onConfirm:n})=>e.jsxs(c,{show:a,onHide:s,centered:!0,children:[e.jsxs(c.Header,{children:[e.jsx(c.Title,{children:"Eliminar movimiento"}),e.jsx("button",{type:"button",className:"btn-close",onClick:s})]}),e.jsxs(c.Body,{children:[e.jsx("p",{children:"¿Seguro que deseas eliminar este movimiento?"}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-3",children:[e.jsx(p,{variant:"light",onClick:s,children:"Cancelar"}),e.jsx(p,{variant:"danger",onClick:()=>{n(),s()},children:"Eliminar"})]})]})]}),L=async()=>{const{data:a}=await v.get("/movements");return a.movements},N=async a=>{await v.delete(`/movements/${a}`)},R=()=>{const a=_(),{data:s=[],isLoading:n}=S({queryKey:["movements"],queryFn:L,staleTime:300*1e3}),o=D({mutationFn:N,onSuccess:(r,t)=>{a.setQueryData(["movements"],(i=[])=>i.filter(d=>d.id!==t))}});return{movements:s,loading:n,removeMovement:r=>o.mutateAsync(r)}},F=()=>{const{movements:a,loading:s,removeMovement:n}=R(),[o,r]=h.useState(null),[t,i]=h.useState(!1),d=u=>{r(u),i(!0)},m=()=>{i(!1),r(null)},b=async()=>{if(o)try{await n(o.id),m()}catch(u){console.error("Error al eliminar movimiento:",u)}};return s?e.jsx("p",{children:"Cargando movimientos..."}):e.jsxs(g,{fluid:!0,children:[e.jsx(C,{title:"Movimientos",subtitle:"Gestionar"}),e.jsx(E,{className:"mb-3",children:e.jsx(k,{children:e.jsx(q,{movements:a,onDeleteMovement:d})})}),e.jsx(w,{open:t,toggle:m,onConfirm:b})]})};export{F as default};
