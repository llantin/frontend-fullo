import{j as e,aK as w,i as L,h as R,aL as q,r as x,f as B,C as A,X as g,aM as P,n as Q,aN as H}from"./index-D8RmveFg.js";import{P as G}from"./PageBreadcrumb-Dw5_9Adg.js";import{E as f,D as I,R as p,M as l,u as K,a as b}from"./server.browser-CequAlAg.js";import{F as v,b as S}from"./FormControl-BP6VLzH_.js";import{c as O,a as E,u as $,o as z}from"./index.esm-DbOhfXXi.js";import{F as U,b as M}from"./Form-BCZM8NW3.js";import{F as N}from"./FormLabel-B53mBRFw.js";import{d as X,u as J,c as V,g as W}from"./categoryService-Bkz0X63C.js";import{C as Y,a as Z}from"./Card-C3khdGa0.js";import"./ElementChildren-DUlSq7n6.js";const ee=({categories:n=[],onEditCategory:r,onDeleteCategory:o})=>{f.use(I);const c=[{title:"Nombre",data:"name"},{title:"Descripción",data:"description"},{title:"Fecha de registro",data:"created_at"},{title:"Acciones",data:null,orderable:!1,render:()=>`
        <div class="d-flex gap-1">
            <button class="btn btn-sm btn-secondary btn-edit">Editar</button>
            <button class="btn btn-sm btn-danger btn-delete">Eliminar</button>
        </div>
        `}],m=n.map(t=>({name:t.name,description:t.description,created_at:new Date(t.created_at).toLocaleDateString("es"),id:t.id})),u={responsive:!0,language:{decimal:",",thousands:".",processing:"Procesando...",search:"Buscar:",lengthMenu:"Mostrar _MENU_ registros",info:"Mostrando _START_ a _END_ de _TOTAL_ registros",zeroRecords:"No se encontraron resultados",emptyTable:"No hay datos disponibles en la tabla",paginate:{first:p.renderToStaticMarkup(e.jsx(q,{})),previous:p.renderToStaticMarkup(e.jsx(R,{})),next:p.renderToStaticMarkup(e.jsx(L,{})),last:p.renderToStaticMarkup(e.jsx(w,{}))}},createdRow:(t,a)=>{const s=t.querySelector(".btn-edit"),i=t.querySelector(".btn-delete");s&&s.addEventListener("click",()=>r(a)),i&&i.addEventListener("click",()=>o(a))},initComplete:function(){const t=this.api().table().header();t&&t.classList.add("thead-sm","text-uppercase","fs-xxs")}};return e.jsx(f,{data:m,columns:c,options:u,className:"table table-striped dt-responsive align-middle mb-0"})},te=({open:n,toggle:r,categoryData:o,isEditable:c,onSave:m})=>{const u=O({name:E().required("Por favor ingrese el nombre de la categoría"),description:E().required("Por favor ingrese la descripción")}),{handleSubmit:t,reset:a,register:s,formState:{errors:i}}=$({resolver:z(u)}),h=y=>{m(y)};return x.useEffect(()=>{a(o?{name:o.name||"",description:o.description||""}:{name:"",description:""})},[o,a,n]),e.jsx(l,{show:n,onHide:r,centered:!0,children:e.jsxs(U,{onSubmit:t(h),children:[e.jsxs(l.Header,{children:[e.jsxs(l.Title,{children:[c?"Editar":"Crear"," categoría"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:r})]}),e.jsxs(l.Body,{children:[e.jsx(B,{children:e.jsxs(A,{sm:12,children:[e.jsxs(M,{className:"mb-3",children:[e.jsx(N,{children:"Nombre"}),e.jsx(v,{type:"text",placeholder:"Nombre de la categoría",...s("name"),isInvalid:!!i.name}),e.jsx(S,{type:"invalid",children:i.name?.message})]}),e.jsxs(M,{className:"mb-3",children:[e.jsx(N,{children:"Descripción"}),e.jsx(v,{type:"text",placeholder:"Descripción",...s("description"),isInvalid:!!i.description}),e.jsx(S,{type:"invalid",children:i.description?.message})]})]})}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-3",children:[e.jsx(g,{variant:"light",onClick:r,children:"Cancelar"}),e.jsx(g,{type:"submit",variant:"primary",children:"Guardar"})]})]})]})})},ae=({open:n,toggle:r,onConfirm:o,categoryName:c})=>e.jsxs(l,{show:n,onHide:r,centered:!0,children:[e.jsxs(l.Header,{children:[e.jsx(l.Title,{children:"Eliminar categoría"}),e.jsx("button",{type:"button",className:"btn-close",onClick:r})]}),e.jsxs(l.Body,{children:[e.jsxs("p",{children:["¿Estás seguro que deseas eliminar la categoría ",e.jsx("strong",{children:c}),"?"]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-3",children:[e.jsx(g,{variant:"light",onClick:r,children:"Cancelar"}),e.jsx(g,{variant:"danger",onClick:()=>{o(),r()},children:"Eliminar"})]})]})]}),se=()=>{const n=P(),{data:r=[],isLoading:o}=K({queryKey:["categories"],queryFn:W,staleTime:300*1e3}),c=b({mutationFn:V,onSuccess:t=>{n.setQueryData(["categories"],(a=[])=>[...a,t.category])}}),m=b({mutationFn:({id:t,data:a})=>J(t,a),onSuccess:t=>{n.setQueryData(["categories"],(a=[])=>a.map(s=>s.id===t.category.id?t.category:s))}}),u=b({mutationFn:X,onSuccess:(t,a)=>{n.setQueryData(["categories"],(s=[])=>s.filter(i=>i.id!==a))}});return{categories:r,loading:o,addCategory:t=>c.mutateAsync(t),editCategory:(t,a)=>m.mutateAsync({id:t,data:a}),removeCategory:t=>u.mutateAsync(t)}},he=()=>{const{categories:n,loading:r,addCategory:o,editCategory:c,removeCategory:m}=se(),[u,t]=x.useState(!1),[a,s]=x.useState(null),[i,h]=x.useState(!1),y=()=>{s(null),t(!0)},T=d=>{s(d),t(!0)},D=d=>{s(d),h(!0)},C=()=>{t(!1),s(null)},j=()=>{h(!1),s(null)},F=async d=>{try{a?await c(a.id,d):await o(d),C()}catch(_){console.error("Error al guardar categoría:",_)}},k=async()=>{if(a)try{await m(a.id),j()}catch(d){console.error("Error al eliminar categoría:",d)}};return r&&n.length===0?e.jsx("p",{children:"Cargando categorías..."}):e.jsxs(Q,{fluid:!0,children:[e.jsx(G,{title:"Categorías",subtitle:"Gestionar"}),e.jsx(Y,{className:"mb-3",children:e.jsxs(Z,{children:[e.jsxs(g,{variant:"primary",className:"mb-3",onClick:y,children:[e.jsx(H,{className:"me-2"}),"Registrar categoría"]}),e.jsx(ee,{categories:n,onEditCategory:T,onDeleteCategory:D})]})}),e.jsx(te,{open:u,toggle:C,categoryData:a,isEditable:!!a,onSave:F}),e.jsx(ae,{open:i,toggle:j,onConfirm:k,categoryName:a?.name})]})};export{he as default};
